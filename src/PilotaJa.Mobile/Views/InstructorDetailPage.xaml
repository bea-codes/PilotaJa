<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PilotaJa.Mobile.ViewModels"
             x:Class="PilotaJa.Mobile.Views.InstructorDetailPage"
             x:DataType="vm:InstructorDetailViewModel"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource Background}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- Avatar and Main Info -->
            <Frame BackgroundColor="{StaticResource Surface}" CornerRadius="16" Padding="24">
                <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                    <Frame WidthRequest="100" HeightRequest="100" CornerRadius="50" BackgroundColor="#E5E7EB" Padding="0">
                        <Label Text="ðŸ‘¤" FontSize="40" VerticalOptions="Center" HorizontalOptions="Center"/>
                    </Frame>
                    <Label Text="{Binding Instructor.Name}" FontSize="24" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label HorizontalOptions="Center" TextColor="{StaticResource TextSecondary}">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="ðŸ“ "/>
                                <Span Text="{Binding Instructor.City}"/>
                                <Span Text=", "/>
                                <Span Text="{Binding Instructor.State}"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    
                    <!-- Stats -->
                    <HorizontalStackLayout Spacing="32" HorizontalOptions="Center" Margin="0,12,0,0">
                        <VerticalStackLayout HorizontalOptions="Center">
                            <Label FontSize="20" FontAttributes="Bold" HorizontalOptions="Center">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="â­ "/>
                                        <Span Text="{Binding Instructor.Rating, StringFormat='{0:F1}'}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                            <Label Text="AvaliaÃ§Ã£o" FontSize="12" TextColor="{StaticResource TextSecondary}" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout HorizontalOptions="Center">
                            <Label Text="{Binding Instructor.TotalLessons}" FontSize="20" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Text="Aulas" FontSize="12" TextColor="{StaticResource TextSecondary}" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout HorizontalOptions="Center">
                            <Label FontSize="20" FontAttributes="Bold" TextColor="{StaticResource Primary}" HorizontalOptions="Center">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="R$ "/>
                                        <Span Text="{Binding Instructor.HourlyRate, StringFormat='{0:F2}'}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                            <Label Text="por hora" FontSize="12" TextColor="{StaticResource TextSecondary}" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Bio -->
            <Frame BackgroundColor="{StaticResource Surface}" CornerRadius="12" Padding="16" IsVisible="{Binding Instructor.Bio, Converter={StaticResource IsNotNullConverter}}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Sobre" FontAttributes="Bold" FontSize="16"/>
                    <Label Text="{Binding Instructor.Bio}" TextColor="{StaticResource TextSecondary}"/>
                </VerticalStackLayout>
            </Frame>

            <!-- 7-Day Agenda -->
            <Frame BackgroundColor="{StaticResource Surface}" CornerRadius="12" Padding="16">
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ“… Agenda (7 dias)" FontAttributes="Bold" FontSize="16"/>
                    
                    <CollectionView ItemsSource="{Binding WeekAgenda}" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="vm:DayAgenda">
                                <Frame Margin="0,4" Padding="12" CornerRadius="8"
                                       BackgroundColor="{StaticResource InputBackground}">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <VerticalStackLayout Grid.Column="0" WidthRequest="50">
                                            <Label Text="{Binding DayName}" FontAttributes="Bold"/>
                                            <Label Text="{Binding DayNumber}" FontSize="12" TextColor="{StaticResource TextSecondary}"/>
                                        
                                        <VerticalStackLayout Grid.Column="1" Margin="12,0">
                                            <CollectionView ItemsSource="{Binding Appointments}" SelectionMode="None">
                                                <CollectionView.ItemTemplate>
                                                    <DataTemplate x:DataType="vm:AppointmentSummary">
                                                        <HorizontalStackLayout Spacing="8">
                                                            <Label Text="{Binding Time}" FontSize="12"/>
                                                            <Label Text="{Binding StatusIcon}" FontSize="12"/>
                                                            <Label Text="{Binding DurationMinutes, StringFormat='{0}min'}" 
                                                                   FontSize="12" TextColor="{StaticResource TextSecondary}"/>
                                                        </HorizontalStackLayout>
                                                    </DataTemplate>
                                                </CollectionView.ItemTemplate>
                                            </CollectionView>
                                        </VerticalStackLayout>
                                        
                                        <Label Grid.Column="2" Text="{Binding Status}" 
                                               FontSize="12" TextColor="{StaticResource TextSecondary}"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Book Lesson -->
            <Frame BackgroundColor="{StaticResource Surface}" CornerRadius="12" Padding="16">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Agendar Aula" FontAttributes="Bold" FontSize="16"/>
                    
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Data" FontSize="14"/>
                        <DatePicker Date="{Binding SelectedDate}"/>
                    </VerticalStackLayout>
                    
                    <VerticalStackLayout Spacing="4">
                        <Label Text="HorÃ¡rio" FontSize="14"/>
                        <TimePicker Time="{Binding SelectedTime}"/>
                    </VerticalStackLayout>
                    
                    <Button Text="ðŸ“… Agendar Aula"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding BookLessonCommand}"/>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
