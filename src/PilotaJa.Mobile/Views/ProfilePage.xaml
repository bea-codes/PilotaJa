<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PilotaJa.Mobile.ViewModels"
             x:Class="PilotaJa.Mobile.Views.ProfilePage"
             x:DataType="vm:ProfileViewModel"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource Background}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- Avatar -->
            <VerticalStackLayout HorizontalOptions="Center" Spacing="8">
                <Frame WidthRequest="100" HeightRequest="100" CornerRadius="50" 
                       BackgroundColor="#374151" Padding="0" HasShadow="False">
                    <Label Text="ðŸ‘¤" FontSize="44" VerticalOptions="Center" HorizontalOptions="Center"/>
                </Frame>
                <Label Text="{Binding Name}" FontSize="22" FontAttributes="Bold" HorizontalOptions="Center"/>
                <Label Text="Aluno desde 2024" TextColor="{StaticResource TextSecondary}" HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- Profile Card -->
            <Frame BackgroundColor="{StaticResource Surface}" CornerRadius="12" Padding="16">
                <VerticalStackLayout Spacing="16">
                    
                    <!-- View Mode -->
                    <VerticalStackLayout Spacing="12" IsVisible="{Binding IsEditing, Converter={StaticResource InverseBoolConverter}}">
                        
                        <Grid ColumnDefinitions="*,*" Padding="0,8">
                            <Label Text="ðŸ“§ E-mail" TextColor="{StaticResource TextSecondary}"/>
                            <Label Grid.Column="1" Text="{Binding Email}" HorizontalTextAlignment="End"/>
                        </Grid>
                        <BoxView HeightRequest="1" Color="#374151"/>
                        
                        <Grid ColumnDefinitions="*,*" Padding="0,8">
                            <Label Text="ðŸ“± Telefone" TextColor="{StaticResource TextSecondary}"/>
                            <Label Grid.Column="1" Text="{Binding Phone}" HorizontalTextAlignment="End"/>
                        </Grid>
                        <BoxView HeightRequest="1" Color="#374151"/>
                        
                        <Grid ColumnDefinitions="*,*" Padding="0,8">
                            <Label Text="ðŸ†” CPF" TextColor="{StaticResource TextSecondary}"/>
                            <Label Grid.Column="1" Text="{Binding TaxId}" HorizontalTextAlignment="End"/>
                        </Grid>
                        <BoxView HeightRequest="1" Color="#374151"/>
                        
                        <Grid ColumnDefinitions="*,*" Padding="0,8">
                            <Label Text="ðŸŽ‚ Nascimento" TextColor="{StaticResource TextSecondary}"/>
                            <Label Grid.Column="1" HorizontalTextAlignment="End">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding FormattedDateOfBirth}"/>
                                        <Span Text=" ("/>
                                        <Span Text="{Binding Age}"/>
                                        <Span Text=" anos)"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </Grid>
                        
                        <Button Text="âœï¸ Editar Perfil" 
                                Style="{StaticResource PrimaryButton}"
                                Command="{Binding StartEditingCommand}"
                                Margin="0,8,0,0"/>
                    </VerticalStackLayout>

                    <!-- Edit Mode -->
                    <VerticalStackLayout Spacing="16" IsVisible="{Binding IsEditing}">
                        
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Nome completo" TextColor="{StaticResource TextSecondary}"/>
                            <Entry Text="{Binding Name}" 
                                   BackgroundColor="#374151" 
                                   TextColor="White"/>
                        </VerticalStackLayout>
                        
                        <VerticalStackLayout Spacing="4">
                            <Label Text="E-mail" TextColor="{StaticResource TextSecondary}"/>
                            <Entry Text="{Binding Email}" 
                                   Keyboard="Email"
                                   BackgroundColor="#374151" 
                                   TextColor="White"/>
                        </VerticalStackLayout>
                        
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Telefone" TextColor="{StaticResource TextSecondary}"/>
                            <Entry Text="{Binding Phone}" 
                                   Keyboard="Telephone"
                                   Placeholder="(11) 99999-9999"
                                   BackgroundColor="#374151" 
                                   TextColor="White"/>
                        </VerticalStackLayout>
                        
                        <VerticalStackLayout Spacing="4">
                            <Label Text="CPF" TextColor="{StaticResource TextSecondary}"/>
                            <Entry Text="{Binding TaxId}" 
                                   Placeholder="000.000.000-00"
                                   BackgroundColor="#374151" 
                                   TextColor="White"/>
                        </VerticalStackLayout>
                        
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Data de nascimento" TextColor="{StaticResource TextSecondary}"/>
                            <DatePicker Date="{Binding DateOfBirth}" 
                                        BackgroundColor="#374151" 
                                        TextColor="White"/>
                        </VerticalStackLayout>
                        
                        <HorizontalStackLayout Spacing="12" HorizontalOptions="Fill">
                            <Button Text="ðŸ’¾ Salvar" 
                                    Style="{StaticResource PrimaryButton}"
                                    Command="{Binding SaveCommand}"
                                    HorizontalOptions="FillAndExpand"/>
                            <Button Text="Cancelar" 
                                    BackgroundColor="#4B5563"
                                    TextColor="White"
                                    Command="{Binding CancelEditingCommand}"
                                    HorizontalOptions="FillAndExpand"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                    
                </VerticalStackLayout>
            </Frame>

            <!-- Quick Links -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Frame Grid.Column="0" BackgroundColor="{StaticResource Surface}" CornerRadius="12" Padding="16">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding GoToInstructorsCommand}"/>
                    </Frame.GestureRecognizers>
                    <VerticalStackLayout HorizontalOptions="Center" Spacing="8">
                        <Label Text="ðŸ”" FontSize="28" HorizontalOptions="Center"/>
                        <Label Text="Buscar Instrutor" FontSize="13" HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>
                
                <Frame Grid.Column="1" BackgroundColor="{StaticResource Surface}" CornerRadius="12" Padding="16">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding GoToAppointmentsCommand}"/>
                    </Frame.GestureRecognizers>
                    <VerticalStackLayout HorizontalOptions="Center" Spacing="8">
                        <Label Text="ðŸ“…" FontSize="28" HorizontalOptions="Center"/>
                        <Label Text="Minhas Aulas" FontSize="13" HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
