<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PilotaJa.Mobile.ViewModels"
             xmlns:dto="clr-namespace:PilotaJa.Shared.DTOs;assembly=PilotaJa.Shared"
             x:Class="PilotaJa.Mobile.Views.InstrutoresPage"
             x:DataType="vm:InstrutoresViewModel"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Search Bar -->
        <SearchBar Grid.Row="0"
                   Placeholder="Buscar por cidade..."
                   Text="{Binding SearchText}"
                   SearchCommand="{Binding SearchCommand}"
                   Margin="16"/>

        <!-- Lista de Instrutores -->
        <RefreshView Grid.Row="1"
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding LoadInstrutoresCommand}">
            
            <CollectionView ItemsSource="{Binding Instrutores}"
                            SelectionMode="Single"
                            SelectionChangedCommand="{Binding SelectInstrutorCommand}"
                            SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}">
                
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="20">
                        <Label Text="ðŸ”" FontSize="48" HorizontalOptions="Center"/>
                        <Label Text="Nenhum instrutor encontrado" 
                               FontSize="16" 
                               TextColor="{StaticResource TextSecondary}"
                               HorizontalOptions="Center"/>
                        <Button Text="Carregar Instrutores"
                                Command="{Binding LoadInstrutoresCommand}"
                                Style="{StaticResource PrimaryButton}"
                                Margin="0,20,0,0"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="dto:InstrutorResumoDto">
                        <Frame Margin="16,8" Padding="16" BackgroundColor="{StaticResource Surface}" CornerRadius="12">
                            <Grid ColumnDefinitions="60,*" ColumnSpacing="16">
                                <!-- Avatar -->
                                <Frame Grid.Column="0" 
                                       WidthRequest="60" 
                                       HeightRequest="60" 
                                       CornerRadius="30"
                                       BackgroundColor="#E5E7EB"
                                       Padding="0">
                                    <Label Text="ðŸ‘¤" 
                                           FontSize="24" 
                                           VerticalOptions="Center" 
                                           HorizontalOptions="Center"/>
                                </Frame>

                                <!-- Info -->
                                <VerticalStackLayout Grid.Column="1" Spacing="4">
                                    <Label Text="{Binding Nome}" 
                                           FontSize="16" 
                                           FontAttributes="Bold"/>
                                    <Label TextColor="{StaticResource TextSecondary}" FontSize="13">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="ðŸ“ "/>
                                                <Span Text="{Binding Cidade}"/>
                                                <Span Text=", "/>
                                                <Span Text="{Binding Estado}"/>
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <Label TextColor="{StaticResource Primary}" 
                                           FontSize="15" 
                                           FontAttributes="Bold">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="R$ "/>
                                                <Span Text="{Binding PrecoHora, StringFormat='{0:F2}'}"/>
                                                <Span Text="/hora"/>
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <HorizontalStackLayout Spacing="12">
                                        <Label TextColor="{StaticResource TextSecondary}" FontSize="13">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="â­ "/>
                                                    <Span Text="{Binding Avaliacao, StringFormat='{0:F1}'}"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                        <Label TextColor="{StaticResource TextSecondary}" FontSize="13">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding TotalAulas}"/>
                                                    <Span Text=" aulas"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Loading -->
        <ActivityIndicator Grid.Row="1"
                           IsRunning="{Binding IsBusy}"
                           IsVisible="{Binding IsBusy}"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"
                           Color="{StaticResource Primary}"/>
    </Grid>

</ContentPage>
